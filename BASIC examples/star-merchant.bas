10 REM ********************************
14 REM *        STAR MERCHANT         *
18 REM *      BY LLOYD JOHNSON        *
22 REM *   ORIGINALLY PUBLISHED ON    *
26 REM *  "BIG COMPUTER GAMES" BOOK   *
30 REM *    BY DAVID H. AHL (1984)    *
32 REM *  PORTED BY LEONARDO MILIANI  *
36 REM *TO LM80C COLOR COMPUTER (2020)*
40 REM ********************************
50 REM *** INITIALIZATION ***
60 DIM A$(20),B$(8),A(5,4),D(10)
70 DIM H(20,4),P(14),S(6),T(10)
75 DIM MZ$(20)
80 SCREEN0:PRINT:PRINTTAB(13);"STAR MERCHANT"
90 PRINT:PRINT"You have just spent 2 million credits"
100 PRINT"on a 2 years lease for a merchant"
110 PRINT"starship. This leaves you with 2"
120 PRINT"million credits operating capital."
130 PRINT
140 PRINT"Your ship can hold a total of 20 cargos"
150 PRINT"with a total cargo weight of 200 tons."
160 PRINT"The fuel capacity of your ship is great"
170 PRINT"enough such that travel between any 2"
180 PRINT"starports is possible without"
190 PRINT"refueling."
200 GOSUB5000:CLS
210 PRINT"You are presently traveling from Alpha"
220 PRINT"Centauri to Sol. You are carrying no"
230 PRINT"cargo."
240 PRINT
260 PRINT"The starport trade classification"
270 PRINT"determines the cargo price but does not"
280 PRINT"determine which cargos are available."
290 PRINT
300 PRINT"Abbreviations used for trade class are"
310 PRINT"as follows:"
320 PRINT"  R-Rich; P-Poor; I-Industrial;"
330 PRINT"  NI-NonIndustrial; A-Agricultural;"
340 PRINT"  NA-NonAgricultural"
350 PRINT
370 GOSUB5000
380 CLS:PRINT"Commands available are as follows:":PRINT
390 GOSUB3420
395 PRINT:PRINT"Initializing game... please wait..."
400 PRINT"Creating initial data..."
410 R1=1
420 I=INT(RND(-ABS(TMR(0)))*500)+1
450 FORJ=1TOI
460 D9=RND(R1)
470 NEXTJ
480 DEF FNA(R1)=INT(6*RND(R1))+1
490 DEF FNB(N2)=INT(N2*RND(R1))+1
500 DEF FNC(R1)=FNA(R1)+FNA(R1)
510 B2=2000000
520 D(5)=4.3
530 S1=5
540 E1=50000
550 E2=100000
560 E3=500000
570 N2=36
580 N3=10
590 W1=200
600 W2=W1
610 PRINT"Generating items data...":FORI=1TO20
620 H(I,1)=0
630 NEXT
640 GOSUB3650
650 FORI=1TO14
660 READP(I)
670 NEXT
680 T5=0
690 T6=0
700 T7=0
710 PRINT "Generating stars data...":GOSUB2310
720 REM *** Main Logic ***
730 IF RND(R1)>.01+5E-03*B2/E3THEN750
740 GOSUB1120
750 PRINT
760 PRINT"   Account balance: ";:NM=B2:GOSUB6000:PRINTNM$
765 PRINT" Empty cargo space: ";W2
770 PRINT"         Ship time:";INT(T6*1000)/1000;"years"
780 PRINT:INPUT"Enter command";C1$:C1=VAL(C1$)
790 IFC1>0ANDC1<7ANDC1=INT(ABS(C1))THEN820
800 CLS:GOSUB3420
810 GOTO720
820 ONC1GOSUB1310,1480,1650,1950,2090,2180
830 B3=B2+T1
840 IFB3<OTHEN960
850 IFT6-2*T5<2THEN720
860 PRINT
870 PRINT"The lease has expired on your ship."
880 IFB3<2000000THEN960
890 PRINT"Another lease will cost 2 million"
900 PRINT"credits."
910 INPUT"Do you wish to renew your lease (Y/N) ";A$
920 IFA$="N"ORA$="n"THEN 960
930 B2=B2-2000000
940 T5=T5+1
950 GOTO720
960 REM *** End Program ***
970 G1=(B3-4000000)/T6
980 A$="loss"
990 IFG1<OTHEN1010
1000 A$="gain"
1010 IFB3>0THEN1040
1020 PRINT
1030 PRINT"You no longer have sufficient funds to"
1035 PRINT"operate your ship."
1040 PRINT
1050 PRINT"You began with 4 million credits and"
1060 IFB2<OTHENB2=0
1070 PRINT"now have";B2;"credits."
1080 PRINT"Cargo in the hold is worth";T1
1090 PRINT
1100 PRINT"This represents a ";A$;" of ";ABS(INT(G1*1000)/1000)
1105 PRINT "credits per year."
1110 GOTO 4690
1120 REM *** Strike sub ***
1130 PRINT
1140 PRINT"The crew has gone on strike! You are"
1150 PRINT"currently paying them";E3;"credits":PRINT"anually."
1160 E5=E3+.5*RND(R1)*E3
1170 PRINT"They are asking for";E5;"credits."
1180 N4=0
1190 E6=E3+N4*(E5-E3)/10
1200 PRINT
1210 INPUT"Enter counter offer";E7
1220 IFE7>=E5THEN1280
1230 IFE7<E6THEN1250
1240 IF(E5-E7)/(E5-E6)<RND(R1)THEN1280
1250 PRINT"Offer rejected - try again"
1260 N4=N4+1
1270 GOTO1190
1280 PRINT"Offer accepted."
1290 E3=E7
1300 RETURN
1310 REM *** List Hold ***
1320 PRINT"Cargo stored in hold:"
1330 IFW2<W1THEN1360
1340 PRINT"All partitions are empty."
1350 RETURN
1360 PRINT"Pt Description      AMT  Price     %"
1370 FORI=1TO20
1380 RESTORE
1390 IFH(I,1)=0THEN1460
1400 FORJ=1TO19+H(I,1)
1410 READA$
1420 NEXTJ
1430 READA$
1440 PRINTI;TAB(3);A$;TAB(20);H(I,3);
1450 PRINTTAB(25);H(I,2);TAB(35);H(I,4)
1460 NEXTI
1470 RETURN
1480 REM *** List Cargo for Sale ***
1490 CLS:PRINT"Cargos available for purchase:"
1500 IFN1>0THEN1530
1510 PRINT"All available cargos have been bought."
1520 RETURN
1530 PRINT "No Description       AMT  Price    %"
1540 FORI=1TO5
1550 RESTORE
1560 IFA(I,1)=0THEN1630
1570 FORJ=1TO19+A(I,1)
1580 READA$
1590 NEXTJ
1600 READA$
1610 PRINTI;TAB(3);A$;TAB(20);A(I,3);
1620 PRINTTAB(26);:NM=A(I,2):GOSUB6000:PRINTNM$;TAB(34);A(I,4)
1630 NEXTI
1640 RETURN
1650 REM *** Buy Cargo Sub ***
1660 PRINT"Enter the lot number of cargo that you"
1665 INPUT "want to purchase";K
1670 IFK=ABS(INT(K))ANDK>OANDK<6THEN1700
1680 PRINT"Invalid lot number."
1690 RETURN
1700 IFA(K,1)>0THEN1730
1710 PRINT"Lot ";K;"has already been purchased."
1720 RETURN
1730 IFA(K,2)<=B2THEN1760
1740 PRINT"You can not buy cargo on credit."
1750 RETURN
1760 IFA(K,3)<=W2THEN1790
1770 PRINT"You do not have sufficient cargo space.";
1780 RETURN
1790 FORI=1TO20
1800 IFH(I,1)=0THEN1840
1810 NEXTI
1820 PRINT"All 20 cargo partitions are occupied."
1830 RETURN
1840 FORJ=1TO4
1850 H(I,J)=A(K,J)
1860 NEXTJ
1870 A(K,1)=0
1880 W2=W2-H(I,3)
1890 B2=B2-H(I,2)
1900 T6=T6+3E-03
1910 N1=N1-1
1920 PRINT:PRINT"Transaction completed"
1930 PRINT"Cargo stored in partition";I
1940 RETURN
1950 REM *** Sell Cargo Sub ***
1960 INPUT"Enter partition of cargo to be sold";K
1970 IFK=ABS(INT(K))ANDK>OANDK<21THEN2000
1980 PRINT"Invalid partition number"
1990 RETURN
2000 IFH(K,1)>0THEN2030
2010 PRINT"Cargo partition is empty."
2020 RETURN
2030 B2=B2+H(K,2)
2040 W2=W2+H(K,3)
2050 T6=T6+3E-03
2060 H(K,1)=0
2070 PRINT"Transaction completed"
2080 RETURN
2090 REM *** List Starports Sub ***
2100 PRINT"No.  Name            Trade   Cl   Ds Dir";
2110 RESTORE
2120 FORI=1TO10
2130 READA$,B$
2140 PRINTI;TAB(5);A$;TAB(21);B$;
2150 PRINTTAB(29);D(I);TAB(35);T(I)
2160 NEXT I
2170 RETURN
2180 REM *** Travel Sub ***
2190 IFB2>0THEN2220
2200 PRINT"You can not leave starport until all"
2205 PRINT"debts are cleared."
2210 RETURN
2220 PRINT"Enter destination star number";
2230 INPUTI
2240 IFI<>S1THEN2270
2250 PRINT"You are already at:";I
2260 RETURN
2270 IFI=ABS(INT(I))ANDI>0ANDI<N3+1THEN2300
2280 PRINT"Invalid star number"
2290 RETURN
2300 S1=I
2310 REM *** Get Star Trade & Location Data ***
2320 GOSUB3510:PRINT"Loading stars data..."
2330 IFS1=1THEN2370
2340 FORI=1TO(S1-1)*3
2350 READD9
2360 NEXTI
2370 READX3,Y3,M1
2380 FORI=1TO6
2390 M2=2^(6-I)
2400 S(I)=INT(M1/M2)
2410 M1=M1-S(I)*M2
2420 NEXTI
2430 REM *** Appraise Cargo in Hold ***
2440 T1=O
2450 FORI=1TO20
2460 IFH(I,1)=0THEN2660
2470 GOSUB3580
2480 IFH(I,1)=1THEN2520
2490 FORJ=1TO(H(I,1)-1)*8
2500 READD9
2510 NEXTJ
2520 D2=0
2530 FORJ=1TO6
2540 READD3
2550 D2=D2+D3*S(J)
2560 NEXTJ
2570 READB1
2500 P2=FNC(R1)+D2-1
2590 IFP2>1THEN2610
2600 P2=1
2610 IFP2<14THEN2630
2620 P2=14
2630 H(I,4)=P(P2)*100
2640 H(I,2)=P(P2)*B1*H(I,3)
2650 T1=T1+H(I,2)
2660 NEXTI
2670 REM *** Get Cargos for Sale ***
2675 PRINT "Loading cargos data..."
2680 N1=5
2690 FORI=1TO5
2700 D2=0
2710 T2=FNB(N2)
2720 A(I,1)=T2
2730 GOSUB3580
2740 IFT2=1THEN2780
2750 FORJ=1TO(T2-1)*8
2760 READD9
2770 NEXTJ
2780 FORJ=1TO6
2790 READD3
2800 D2=D2+D3*S(J)
2810 NEXTJ
2820 P2=FNC(R1)+D2-1
2830 IFP2>1THEN2850
2840 P2=1
2850 IFP2<14THEN2870
2860 P2=14
2870 A(I,4)=P(P2)*100
2880 READB1,Q1
2890 Q2=1
2900 IFT2<17THEN2940
2910 Q2=5
2920 IFT2<32THEN2940
2930 Q2=10
2940 Q3=0
2950 FORJ=1TOQ1
2960 Q3=FNA(R1)*Q2+Q3
2970 NEXTJ
2980 IFQ3>200THENQ3=200
2990 A(I,3)=Q3
3000 A(I,2)=B1*Q3*P(P2)
3010 NEXTI
3020 REM *** Dist. and Direction of Stars ***
3025 PRINT "Loading stars data..."
3030 D4=D(S1)
3040 GOSUB3510
3050 FORI=1TO10
3060 READX1,Y1,D9
3070 X2=X1-X3
3080 Y2=Y1-Y3
3090 IFX2<>0THEN3150
3100 IFY2<0THEN3130
3110 T(I)=90
3120 GOTO3220
3130 T(I)=270
3140 GOTO3220
3150 T(I)=ATN(Y2/X2)*180/3.14159
3160 IFX2>0THEN3180
3170 T(I)=T(I)+180
3180 IFT(I)<360THEN3200
3190 T(I)=T(I)-360
3200 IFT(I)>0THEN3220
3210 T(I)=T(I)+360
3220 D(I)=SQR(X2^2+Y2^2)
3230 NEXTI
3240 REM *** Arrival Expense and Star Name ***
3250 T6=T6+.02*D4+.02
3260 E4=(T6-T7)*E3
3270 T7=T6
3280 RESTORE
3290 IFS1=1THEN3330
3300 FORI=1TOS1-1
3310 READA$,B$
3320 NEXTI
3330 READA$,B$
3340 PRINT
3350 CLS:PRINT"You have arrived at ";A$;". ":PRINT
3360 PRINT"Expenses have been deducted as follows:"
3370 PRINTTAB(7)"Docking fee: ";:NM=E1:GOSUB6000:PRINTNM$
3380 PRINTTAB(14) "Fuel: ";:NM=E2*D4:GOSUB6000:PRINTNM$
3390 PRINTTAB(7) "Crew salary: ";:NM=E4:GOSUB6000:PRINTNM$
3400 B2=B2-(E1+E2*D4+E4)
3410 RETURN
3420 PRINT"Command";TAB(12);"Description"
3430 PRINTTAB(3)"1";TAB(12);"List cargo in hold"
3440 PRINTTAB(3)"2";TAB(12);"List cargo which"
3445 PRINTTAB(12)"may be purchased"
3450 PRINTTAB(3)"3";TAB(12);"Buy cargo"
3460 PRINTTAB(3)"4";TAB(12);"Sell cargo"
3470 PRINTTAB(3)"5";TAB(12);"List starports"
3480 PRINTTAB(3)"6";TAB(12);"Travel to new star"
3490 PRINT" Other";TAB(12);"List available commands"
3500 RETURN
3510 REM *** Restore to Star Data Sub ***
3520 RESTORE
3530 FORL=1TO(2*N3+N2)
3540 READA$
3550 NEXTL
3560 IFKQ=1THENKQ=0:GOTO3600
3570 RETURN
3580 REM *** Restore to Cargo Data Sub ***
3590 KQ=1:GOTO3510
3600 FORL=1TO3*N3
3610 READD9
3620 NEXTL
3630 IFLQ=1THENLQ=0:GOTO3670
3640 RETURN
3650 REM *** Restore to Price Data Sub ***
3660 LQ=1:GOTO3590
3670 FORL=1TO8*N2
3680 READD9
3690 NEXTL
3700 RETURN
3710 REM *** Star Names ***
3720 DATA"Lalande 21185","NI,P"
3730 DATA"Alpha Centauri","NA,I"
3740 DATA"Sirius","A"
3750 DATA"Barnards Star","I,P"
3760 DATA"Sol","R"
3770 DATA"Ross 154","NI,NA"
3780 DATA"Epsilon Eridani","A,P"
3790 DATA"Luyten 726-8","NA"
3800 DATA"Luyten 789-6","A,NI,P"
3810 DATA"Ross 248","A,I"
3820 REM *** Cargo Names ***
3830 DATA"Crystals"
3840 DATA"Radioactives"
3850 DATA"Alloys"
3860 DATA"Medicine"
3870 DATA"Gems"
3880 DATA"Aircraft"
3890 DATA"Grav sleds"
3900 DATA"Computers"
3910 DATA"ATV"
3920 DATA"AFV"
3930 DATA"Firearms"
3940 DATA"Ammunition"
3950 DATA"Plasma guns"
3960 DATA"Tools"
3970 DATA"Body armor"
3980 DATA"Farm machinery"
3990 DATA"Liquor"
4000 DATA"Silver"
4010 DATA"Spices"
4020 DATA"Electronics"
4030 DATA"Mechanical parts"
4040 DATA"Cybernetic parts"
4050 DATA"Computer parts"
4060 DATA"Machine tools"
4070 DATA"Space suits"
4080 DATA"Fruit"
4090 DATA"Textiles"
4100 DATA"Polymers"
4110 DATA"Meat"
4120 DATA"Petrochemicals"
4130 DATA"Grain"
4140 DATA"WCod"
4150 DATA"Copper"
4160 DATA"Tin"
4170 DATA"Steel"
4180 DATA"Aluminum"
4190 REM *** Star Data ***
4200 DATA2.83,-7.36,20
4210 DATA-2.4,-3.56,9
4220 DATA8.38,9.93,2
4230 DATA-6.1,0,24
4240 DATA0,0,32
4250 DATA-8.87,2.05,5
4260 DATA8.45,6.65,18
4270 DATA2.99,7.42,1
4280 DATA-4.43,9.3,22
4290 DATA-.89,10.26,10
4300 REM *** Carga Data ***
4310 DATA3,-2,2,-2,0,-4,20000,1
4320 DATA0,1,4,-3,0,-2,1000000,1
4330 DATA-2,0,-4,6,1,-2,200000,1
4340 DATA-1,4,-4,3,-2,0,100000,1
4350 DATA4,-2,4,-4,-1,1,1000000,1
4360 DATA-2,4,-3,3,1,-1,1000000,1
4370 DATA2.0,-1,1,0,0,6000000,1
4380 DATA1,0,-2,0,0,0,10000000,1
4390 DATA-2,2,-2, 1,1,0,300000,1
4400 DATA0,2,-2,0,0,1,700000,1
4410 DATA-2,6,-4,1,0,0,30000,2
4420 DATA-1,6,-5,2,0,0,30000,2
4430 DATA-1,3,-2,0,0, 0,200000,2
4440 DATA-4,7,-8,4,5,0,10000,2
4450 DATA-3,6,-4,1,0,0,50000,2
4460 DATA-2,2,-6,0,6,-4,150000,1
4470 DATA3,3,-1,0,-3,0,10000,1
4480 DATA3,-1,3,-1,0,-2,70000,1
4490 DATA4,-2,3,-1,-5,2,6000,1
4500 DATA0,0,-4,4,1,,1,100000,1
4510 DATA0,1,-3,3,2, 1,75000,1
4520 DATA1,0,-4,2,1,0,250000,1
4530 DATA-1,0,-2,3,0,0,150000,1
4540 DATA1,0,-2,1,0,0,750000,1
4550 DATA-1,2,-3,2,2,0,400000,1
4560 DATA1,2,3,3,-4,6,1000,2
4570 DATA3,0,-3,1,-5,-3,3000,3
4580 DATA-2,0,3,3,0,0,7000,4
4590 DATA0,0,5,2,-5,5,1500,4
4600 DATA2,0,4,-2,3,0,10000,6
4610 DATA0,0,1,3,-5, 6,300,8
4620 DATA0,0,1,2,-7,3,1000,2
4630 DATA2,2,3,-2,-1,-4,2000,2
4640 DATA2,2,3,-4,-1,-2,9000,3
4650 DATA-1,2,6,0,0,0,500,4
4660 DATA-1,1,3,-2,0,-2,1000,5
4670 REM *** Price Data ***
4680 DATA .4,.5,.7,.8,.9,1,1.1,1.2,1.3,1.5,1.7,2,3,4
4690 END
5000 PRINT:PRINT"Press any key to continue..."
5010 A=INKEY(10)
5020 A=INKEY(10):IFA=0THEN5020
5030 RETURN
6000 FORTI=0TO20:MZ$(TI)="":NEXT:TP$=STR$(NM)
6010 SM=SGN(NM):A=0:TI=1
6020 IFMID$(TP$,TI,1)="E"THENA=TI:GOTO6080
6030 IFTI<LEN(TP$)THENTI=TI+1:GOTO6020
6040 IFA<>0THEN6080
6050 NM$=STR$(NM):IFLEFT$(NM$,1)<>" "THEN6070
6060 MT$=RIGHT$(NM$,LEN(NM$)-1):NM$=MT$
6070 RETURN
6080 SE$=MID$(TP$,A+1)
6090 SE=VAL(SE$)
6100 MA$=LEFT$(TP$,A-1)
6110 MT$=RIGHT$(MA$,LEN(MA$)-1):MA$=MT$
6120 TI=0:TJ=1:A=0
6130 A$=MID$(MA$,TJ,1):IFA$="."THENA=TJ:GOTO6150
6140 MZ$(TI)=A$:TI=TI+1
6150 TJ=TJ+1:IFTJ<=LEN(MA$)THEN6130
6160 IFSE>0THENEE=LEN(MA$)-A:GOTO6180
6170 GOTO6240
6180 IFEE<ABS(SE)+1THENEE=ABS(SE)-TI
6185 FORTJ=TITOTI+EE:MZ$(TJ)="0":NEXT
6190 NM$="":TI=0
6200 IFMZ$(TI)=""THEN6230
6210 NM$=NM$+MZ$(TI):TI=TI+1:IFTI>20THEN6230
6220 GOTO 6200
6230 SM$="":IFSM<0THENSM$="-"
6235 NM$=SM$+NM$:RETURN
6240 TI=0
6250 IFMZ$(TI)<>""THENTI=TI+1:GOTO6250
6260 SM$="":IFSM<0THENSM$="-"
6270 NM$=SM$+"0."
6280 FORTJ=2TOABS(SE)-1:NM$=NM$+"0":NEXT
6290 FORTJ=0TOTI:NM$=NM$+MZ$(TJ):NEXT
6300 RETURN

